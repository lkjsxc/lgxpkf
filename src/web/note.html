<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LGXPKF Note {{NOTE_ID}}</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Sora:wght@500;700&family=Source+Serif+4:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f7f1ea;--ink:#1b1a17;--muted:#6b635c;--panel:#fffaf3;--line:#e1d8cf;--accent:#0d6f68;--accent-2:#ef5b2a;--shadow:rgba(20,16,12,0.18);--mono:"JetBrains Mono",monospace;--sans:"Sora",sans-serif;--serif:"Source Serif 4",serif}
*{box-sizing:border-box}
body{margin:0;font-family:var(--serif);color:var(--ink);background:radial-gradient(circle at 12% 16%,rgba(239,91,42,0.12),transparent 50%),radial-gradient(circle at 88% 20%,rgba(13,111,104,0.18),transparent 55%),linear-gradient(180deg,#f7f1ea 0%,#f2e9df 100%);min-height:100vh}
a{text-decoration:none;color:inherit}
.topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:18px 24px;background:rgba(247,241,234,0.92);backdrop-filter:blur(10px);border-bottom:1px solid var(--line);font-family:var(--sans)}
.brand{font-size:1.05rem;letter-spacing:0.32em;font-weight:700}
.account{display:flex;align-items:center;gap:12px}
.account-info{display:flex;align-items:center;gap:10px;font-size:0.85rem}
.account-info span{font-family:var(--mono);font-size:0.75rem;color:var(--muted)}
button{border:none;border-radius:999px;padding:8px 16px;font-weight:600;background:var(--accent-2);color:#1b1a17;cursor:pointer;font-family:var(--sans)}
button.ghost{background:transparent;border:1px solid var(--line);color:var(--ink)}
button:disabled{opacity:0.6;cursor:not-allowed}
main{max-width:1100px;margin:0 auto;padding:36px 24px 120px;display:grid;gap:28px;animation:fade 0.6s ease both}
.article{background:var(--panel);border:1px solid var(--line);border-radius:28px;padding:32px;box-shadow:0 26px 70px var(--shadow)}
.eyebrow{font-family:var(--sans);text-transform:uppercase;letter-spacing:0.2em;font-size:0.7rem;color:var(--accent)}
.title{margin:10px 0 12px;font-family:var(--sans);font-size:clamp(2rem,4.5vw,3.4rem);letter-spacing:-0.02em}
.meta{display:flex;flex-wrap:wrap;gap:12px;font-size:0.85rem;color:var(--muted);font-family:var(--sans)}
.meta .mono{font-family:var(--mono)}
.article-body{margin-top:24px;line-height:1.7;font-size:1.05rem}
.article-body h1,.article-body h2,.article-body h3{font-family:var(--sans);letter-spacing:-0.01em}
.article-body pre{background:#1e1a18;color:#f8f3ea;padding:16px;border-radius:16px;overflow:auto;font-size:0.9rem}
.article-body code{font-family:var(--mono)}
.article-body blockquote{border-left:3px solid var(--accent);padding-left:16px;color:#4d4944}
.side{display:flex;flex-direction:column;gap:18px;font-family:var(--sans)}
.card{background:var(--panel);border:1px solid var(--line);border-radius:22px;padding:20px;box-shadow:0 16px 40px var(--shadow)}
.card-title{font-size:1rem;margin-bottom:10px;text-transform:uppercase;letter-spacing:0.18em;color:var(--muted)}
.meta-grid{display:grid;grid-template-columns:120px 1fr;gap:8px;font-size:0.85rem;color:var(--muted)}
.meta-grid .mono{font-family:var(--mono);color:var(--ink)}
.action-row{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.chain-list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
.chain-item{display:flex;flex-direction:column;gap:4px;padding:10px 12px;border-radius:14px;border:1px solid var(--line);background:#fffdf7;color:var(--ink)}
.chain-label{font-size:0.7rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--accent)}
.chain-text{font-size:0.85rem;color:var(--muted);font-family:var(--mono)}
.empty{font-size:0.85rem;color:var(--muted)}
.helper{font-size:0.8rem;color:var(--muted);margin-top:8px}
@keyframes fade{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@media (min-width:980px){main{grid-template-columns:minmax(0,1fr) 320px}}
@media (max-width:720px){.topbar{flex-direction:column;align-items:flex-start;gap:12px}.meta-grid{grid-template-columns:1fr}.article{padding:24px}}
</style>
</head>
<body data-client-id="{{CLIENT_ID}}">
<header class="topbar">
  <a class="brand" href="/">LGXPKF</a>
  <div class="account">
    <div id="signin"></div>
    <div class="account-info" id="account-info" hidden>
      <span id="account-email"></span>
      <button class="ghost" id="signout" type="button">Sign out</button>
    </div>
  </div>
</header>
<main>
  <article class="article">
    <div class="eyebrow">Note</div>
    <h1 class="title">{{NOTE_TITLE}}</h1>
    <div class="meta">
      <span>{{NOTE_CREATED_AT}}</span>
      <span>{{NOTE_AUTHOR}}</span>
      <span class="mono">{{NOTE_ID}}</span>
    </div>
    <div class="article-body">{{NOTE_BODY}}</div>
  </article>
  <aside class="side">
    <div class="card">
      <div class="card-title">Context</div>
      <div class="meta-grid">
        <div>Note ID</div>
        <div class="mono">{{NOTE_ID}}</div>
        <div>Author</div>
        <div class="mono">{{NOTE_AUTHOR}}</div>
        <div>Created</div>
        <div class="mono">{{NOTE_CREATED_AT}}</div>
        <div>Chain</div>
        <div class="mono">{{CHAIN_SUMMARY}}</div>
      </div>
      <div class="action-row">
        <button class="ghost" id="copy-link" type="button">Copy link</button>
        <a class="ghost" href="/notes/{{NOTE_ID}}">JSON</a>
      </div>
      <div class="helper" id="copy-status"></div>
    </div>
    <div class="card">
      <div class="card-title">Chain</div>
      <div class="helper">{{CHAIN_SUMMARY}}</div>
      <div class="chain-list">{{CHAIN_ITEMS}}</div>
    </div>
  </aside>
</main>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
(() => {
  const el = (id) => document.getElementById(id);
  const state = { token: localStorage.getItem("lgxpkf.session"), user: null };
  const clientId = document.body.dataset.clientId || "";
  const signoutBtn = el("signout");
  const signinWrap = el("signin");
  const accountInfo = el("account-info");
  const copyBtn = el("copy-link");
  const copyStatus = el("copy-status");
  const setSignedIn = (signedIn) => {
    signoutBtn.disabled = !signedIn;
    accountInfo.hidden = !signedIn;
    signinWrap.hidden = signedIn;
  };
  const storeToken = (token) => {
    state.token = token;
    if (token) { localStorage.setItem("lgxpkf.session", token); }
    else { localStorage.removeItem("lgxpkf.session"); }
    setSignedIn(Boolean(token));
  };
  const api = async (path, options = {}) => {
    const headers = options.headers || {};
    if (state.token) { headers.Authorization = `Bearer ${state.token}`; }
    const response = await fetch(path, { ...options, headers });
    const data = await response.json().catch(() => ({}));
    if (!response.ok) { throw new Error(data.message || "Request failed"); }
    return data;
  };
  const refreshSession = async () => {
    if (!state.token) { setSignedIn(false); return; }
    try {
      const data = await api("/auth/me", { headers: {} });
      state.user = data.user;
      el("account-email").textContent = data.user.email;
      setSignedIn(true);
    } catch (_) {
      storeToken(null);
    }
  };
  const handleCredential = async (payload) => {
    try {
      const data = await api("/auth/google", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id_token: payload.credential })
      });
      storeToken(data.token);
      state.user = data.user;
      el("account-email").textContent = data.user.email;
    } catch (err) {
      storeToken(null);
    }
  };
  copyBtn.addEventListener("click", async () => {
    if (!navigator.clipboard) { copyStatus.textContent = "Clipboard unavailable."; return; }
    try {
      await navigator.clipboard.writeText(window.location.href);
      copyStatus.textContent = "Link copied.";
    } catch (_) {
      copyStatus.textContent = "Copy failed.";
    }
  });
  signoutBtn.addEventListener("click", () => {
    storeToken(null);
    state.user = null;
    el("account-email").textContent = "";
  });
  window.addEventListener("load", () => {
    if (!clientId) { setSignedIn(false); return; }
    if (!window.google || !google.accounts || !google.accounts.id) { setSignedIn(false); return; }
    google.accounts.id.initialize({ client_id: clientId, callback: handleCredential });
    google.accounts.id.renderButton(signinWrap, { theme: "outline", size: "large", text: "signin_with" });
    refreshSession();
  });
})();
</script>
</body>
</html>
