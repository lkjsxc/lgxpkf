"use strict";(()=>{var s=n=>document.getElementById(n);var u=n=>{try{return localStorage.getItem(n)}catch{return null}},d=(n,i)=>{try{i===null?localStorage.removeItem(n):localStorage.setItem(n,i)}catch{return}};(()=>{let n="2025-02-01",i="lgxpkf.policy_acceptance.v1",l=document.body.dataset.clientId||"",g=document.body.dataset.loginUri||"",o=s("policy-consent"),p=s("policy-status"),c=s("signin-button"),r=s("signin-status"),b=t=>t&&t.startsWith("/")&&!t.startsWith("//")&&!t.includes("://")?t:"/",w=new URLSearchParams(window.location.search).get("next"),f=b(w),a=()=>{let t=u(i);if(!t)return null;try{let e=JSON.parse(t);return e&&e.accepted===!0&&e.version===n?e:null}catch{return null}},E=t=>{if(!t)return d(i,null),null;let e={accepted:!0,version:n,agreed_at:new Date().toISOString()};return d(i,JSON.stringify(e)),e},m=()=>{let t=!!a();o&&(o.checked=t),p&&(p.textContent=t?"Consent recorded.":"Consent required before sign-in.")},_=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"filled_black":"outline",h=()=>window.google,y=()=>{var e;if(!l){r&&(r.textContent="Missing GOOGLE_CLIENT_ID configuration.");return}if(!g){r&&(r.textContent="Missing PUBLIC_BASE_URL configuration.");return}if(!a()||!c)return;let t=h();(e=t==null?void 0:t.accounts)!=null&&e.id&&(t.accounts.id.initialize({client_id:l,ux_mode:"redirect",login_uri:g,state:JSON.stringify({path:f,policy_acceptance:a()})}),t.accounts.id.renderButton(c,{theme:_(),size:"large",text:"signin_with",shape:"pill"}),c.hidden=!1)},x=()=>{var e,S;if((S=(e=h())==null?void 0:e.accounts)!=null&&S.id){y();return}if(document.getElementById("gsi-script"))return;let t=document.createElement("script");t.id="gsi-script",t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>y(),t.onerror=()=>{r&&(r.textContent="Google sign-in failed to load.")},document.head.appendChild(t)},L=async()=>{let t=u("lgxpkf.session");if(t)try{if(!(await fetch("/auth/me",{headers:{Authorization:`Bearer ${t}`}})).ok)return;window.location.replace(f)}catch{return}};m(),L(),o&&o.addEventListener("change",()=>{E(o.checked),m(),o.checked&&x(),!o.checked&&c&&(c.hidden=!0)}),a()&&x()})();})();
