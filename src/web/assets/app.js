"use strict";(()=>{var h=async(o,e,r={})=>{let a=new Headers(r.headers||{});e&&a.set("Authorization",`Bearer ${e}`);let n=await fetch(o,{...r,headers:a}),c=await n.json().catch(()=>({}));if(!n.ok){let s=c.message||"Request failed",l=new Error(s);throw l.status=n.status,l}return c};var i=o=>document.getElementById(o);var E=o=>{try{return localStorage.getItem(o)}catch{return null}},x=(o,e)=>{try{e===null?localStorage.removeItem(o):localStorage.setItem(o,e)}catch{return}};(()=>{let o="lgxpkf.session",e={token:E(o),user:null},r=i("signin-link"),a=i("post-link"),n=i("account-toggle"),c=i("account-label"),s=i("account-menu"),l=i("account-email"),p=i("account-signout"),L=t=>t.length>26?`${t.slice(0,12)}...${t.slice(-8)}`:t,k=()=>{if(!r)return;let t=encodeURIComponent(`${window.location.pathname}${window.location.search}`);r.href=`/signin?next=${t}`},u=t=>{!s||!n||(s.hidden=!t,n.setAttribute("aria-expanded",t?"true":"false"))},d=t=>{if(document.body.dataset.signedIn=t?"true":"false",r&&(r.hidden=t),a&&(a.hidden=!t),n&&(n.hidden=!t),t||u(!1),t&&e.user){let f=e.user.email||"Account";c&&(c.textContent=L(f)),l&&(l.textContent=f)}},g=()=>{let t={token:e.token,user:e.user};window.lgxpkfSession=t,window.dispatchEvent(new CustomEvent("lgxpkf:session",{detail:t}))},m=()=>{x(o,null),e.token=null,e.user=null},w=async()=>{if(!e.token){d(!1),g();return}try{let t=await h("/auth/me",e.token,{headers:{}});e.user=t.user,d(!0),g()}catch{m(),d(!1),g()}};k(),w(),n&&n.addEventListener("click",t=>{t.stopPropagation();let f=s?s.hidden:!1;u(!!f)}),p&&p.addEventListener("click",()=>{m(),d(!1),g(),window.location.assign("/")}),document.addEventListener("click",t=>{!s||s.hidden||s.contains(t.target)||n&&n.contains(t.target)||u(!1)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&u(!1)})})();})();
