"use strict";(()=>{(()=>{let a=document.getElementById("network-canvas");if(!a)return;let r=a.getContext("2d");if(!r)return;let o={nodes:[],edges:[],hover:null,nodeIndex:new Map},b=(e,t)=>e+Math.random()*(t-e),p=(e,t,s)=>Math.min(s,Math.max(t,e)),w=async e=>{let t=await fetch(e);if(!t.ok)throw new Error("Network load failed");return t.json()},E=e=>Array.isArray(e)?e:[],N=()=>{let{clientWidth:e,clientHeight:t}=a,s=window.devicePixelRatio||1;a.width=e*s,a.height=t*s,r.setTransform(s,0,0,s,0,0)},y=(e,t)=>{var n;if(e.has(t.id))return e.get(t.id);let s=Math.max(a.clientWidth,160),h=Math.max(a.clientHeight,160),c={id:t.id,label:((n=t.author)==null?void 0:n.email)||"note",x:b(60,s-60),y:b(60,h-60),vx:0,vy:0};return e.set(t.id,c),c},M=async()=>{let e=E(await w("/notes/random?limit=24")),t=new Map;e.forEach(n=>y(t,n));let s=new Set,h=await Promise.all(e.map(n=>w(`/notes/${n.id}/related`).catch(()=>null))),c=[];h.forEach(n=>{let i=n;if(!(i!=null&&i.center))return;let d=y(t,i.center);(Array.isArray(i.related)?i.related:[]).forEach(f=>{if(!(f!=null&&f.note))return;let l=y(t,f.note),x=d.id<l.id?`${d.id}:${l.id}`:`${l.id}:${d.id}`;s.has(x)||(s.add(x),c.push({a:d.id,b:l.id}))})}),o.nodes=Array.from(t.values()),o.edges=c,o.nodeIndex=new Map(o.nodes.map(n=>[n.id,n]))},I=()=>{let e=o.nodes,t=o.edges,s=9e3,h=.002,c=.86;for(let n=0;n<e.length;n+=1){let i=e[n];for(let d=n+1;d<e.length;d+=1){let g=e[d],f=i.x-g.x,l=i.y-g.y,x=Math.hypot(f,l)||1,u=s/(x*x),v=f/x*u,m=l/x*u;i.vx+=v,i.vy+=m,g.vx-=v,g.vy-=m}}t.forEach(n=>{let i=o.nodeIndex.get(n.a),d=o.nodeIndex.get(n.b);if(!i||!d)return;let g=d.x-i.x,f=d.y-i.y,l=Math.hypot(g,f)||1,u=(l-160)*h,v=g/l*u,m=f/l*u;i.vx+=v,i.vy+=m,d.vx-=v,d.vy-=m}),e.forEach(n=>{n.vx*=c,n.vy*=c,n.x=p(n.x+n.vx,30,a.clientWidth-30),n.y=p(n.y+n.vy,30,a.clientHeight-30)})},L=()=>{r.clearRect(0,0,a.clientWidth,a.clientHeight),r.lineWidth=1,r.strokeStyle="rgba(106,227,255,0.18)",o.edges.forEach(e=>{let t=o.nodeIndex.get(e.a),s=o.nodeIndex.get(e.b);!t||!s||(r.beginPath(),r.moveTo(t.x,t.y),r.lineTo(s.x,s.y),r.stroke())}),o.nodes.forEach(e=>{let t=o.hover&&o.hover.id===e.id;r.fillStyle=t?"#f0b35a":"#6ae3ff",r.beginPath(),r.arc(e.x,e.y,t?6:4,0,Math.PI*2),r.fill()}),o.hover&&(r.fillStyle="#e7eef8",r.font="12px sans-serif",r.fillText(o.hover.label,o.hover.x+10,o.hover.y-10))},k=()=>{I(),L(),window.requestAnimationFrame(k)},A=(e,t)=>{let s=null,h=18;return o.nodes.forEach(c=>{let n=Math.hypot(c.x-e,c.y-t);n<h&&(h=n,s=c)}),s};a.addEventListener("mousemove",e=>{let t=a.getBoundingClientRect(),s=e.clientX-t.left,h=e.clientY-t.top;o.hover=A(s,h)}),a.addEventListener("click",()=>{o.hover&&window.location.assign(`/${o.hover.id}`)}),window.addEventListener("resize",N),N(),M().then(()=>window.requestAnimationFrame(k)).catch(()=>{r.fillStyle="#93a2bb",r.font="14px sans-serif",r.fillText("Network unavailable.",24,48)})})();})();
